<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Universal LLM Cost Savings Calculator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .config-section {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 4px solid #667eea;
        }
        
        .config-section h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.3em;
        }
        
        .input-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-item {
            display: flex;
            flex-direction: column;
        }
        
        label {
            font-weight: 600;
            color: #555;
            margin-bottom: 8px;
            font-size: 0.95em;
        }
        
        input, select, textarea {
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 6px;
            font-size: 1em;
            transition: border-color 0.3s;
            font-family: inherit;
        }
        
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        textarea {
            resize: vertical;
            min-height: 80px;
        }
        
        .two-col {
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        }
        
        .button-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            font-size: 1em;
            font-weight: 600;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }
        
        .btn-secondary {
            background: #e8eef7;
            color: #667eea;
        }
        
        .btn-secondary:hover {
            background: #d4dfe8;
        }
        
        .btn-disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .results-section {
            display: none;
            margin-top: 40px;
        }
        
        .results-section.active {
            display: block;
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .chart-container {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
        }
        
        .chart-wrapper {
            position: relative;
            height: 400px;
            margin-bottom: 20px;
        }
        
        .table-container {
            overflow-x: auto;
            margin-bottom: 30px;
        }
        
        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
        }
        
        th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }
        
        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }
        
        tr:hover {
            background: #f8f9fa;
        }
        
        .metric {
            display: inline-block;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9em;
        }
        
        .savings {
            color: #10b981;
            font-weight: 600;
        }
        
        .highlight-row {
            background: #f0f4ff;
            font-weight: 600;
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #c33;
            display: none;
        }
        
        .success-message {
            background: #efe;
            color: #3c3;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
            border-left: 4px solid #3c3;
            display: none;
        }
        
        .summary-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.2);
        }
        
        .card h3 {
            font-size: 0.9em;
            opacity: 0.9;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .card-value {
            font-size: 2em;
            font-weight: 700;
        }
        
        .provider-section {
            background: #f0f4ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .provider-section h3 {
            color: #333;
            margin-bottom: 15px;
        }
        
        .field-row {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .field-row .input-item {
            flex: 1;
            min-width: 200px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üí∞ Universal LLM Cost Savings Calculator</h1>
            <p>Compare token costs across JSON, TOON, and VSC formats for any LLM provider</p>
        </div>
        
        <div class="content">
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <div class="config-section">
                <h2>LLM Provider Configuration</h2>
                
                <div class="input-item" style="margin-bottom: 20px;">
                    <label for="provider">Select LLM Provider *</label>
                    <select id="provider" onchange="updateProviderFields()">
                        <option value="">-- Choose Provider --</option>
                        <option value="azure">Azure OpenAI</option>
                        <option value="openai">OpenAI</option>
                        <option value="claude">Anthropic Claude</option>
                        <option value="google">Google Gemini</option>
                        <option value="databricks">Databricks</option>
                        <option value="ollama">Ollama (Local)</option>
                        <option value="generic">Generic/Custom</option>
                    </select>
                </div>
                
                <div id="providerConfig"></div>
                
                <div class="provider-section">
                    <h3>Test Configuration</h3>
                    <div class="input-group two-col">
                        <div class="input-item">
                            <label for="testPrompt">Test Prompt *</label>
                            <textarea id="testPrompt" placeholder="Enter a prompt to test">Explain the concept of machine learning in 50 words.</textarea>
                        </div>
                        <div class="input-item">
                            <label for="iterations">Number of Iterations</label>
                            <input type="number" id="iterations" value="3" min="1" max="20">
                        </div>
                    </div>
                    <div style="background: #e8f5e9; padding: 15px; border-radius: 6px; margin-top: 15px;">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer; font-weight: 600;">
                            <input type="checkbox" id="autoDetect" checked>
                            <span>ü§ñ Auto-detect Best Format</span>
                        </label>
                        <p style="font-size: 0.9em; color: #666; margin-top: 8px; margin-left: 30px;">Automatically analyzes your prompt and recommends the most efficient format</p>
                    </div>
                </div>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="runComparison()">üöÄ Run Comparison</button>
                    <button class="btn-secondary" onclick="clearResults()">Clear Results</button>
                </div>
            </div>
            
            <div class="loading" id="loading">
                <div class="spinner"></div>
                <p>Calling LLM API... This may take a moment.</p>
            </div>
            
            <div class="results-section" id="resultsSection">
                <h2 style="color: #333; margin-bottom: 30px;">üìä Results & Analysis</h2>
                
                <div class="summary-cards" id="summaryCards"></div>
                
                <div class="chart-container">
                    <h3 style="margin-bottom: 20px; color: #333;">Token Count Comparison</h3>
                    <div class="chart-wrapper">
                        <canvas id="tokenChart"></canvas>
                    </div>
                </div>
                
                <h3 style="margin-bottom: 20px; color: #333;">üìà Detailed Analysis</h3>
                <div class="table-container">
                    <table id="resultsTable"></table>
                </div>
                
                <h3 style="margin-bottom: 20px; color: #333; margin-top: 30px;">üîç Format Wrapper Comparison</h3>
                <div class="table-container">
                    <table id="wrapperComparisonTable"></table>
                </div>
                
                <h3 style="margin-bottom: 20px; color: #333; margin-top: 30px;">‚úì Response Accuracy Check</h3>
                <div class="table-container">
                    <table id="accuracyTable"></table>
                </div>
                
                <div style="background: #f0f4ff; padding: 15px; border-radius: 8px; color: #666; font-size: 0.9em;">
                    <strong>Note:</strong> Cost calculations are estimates based on standard pricing models. Actual costs may vary based on your provider's pricing tier and any volume discounts. The prompt wrapper is optimized to preserve LLM accuracy while reducing token overhead.
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let tokenChart = null;
        
        const providerConfigs = {
            azure: {
                label: 'Azure OpenAI',
                fields: [
                    { name: 'apiKey', label: 'API Key *', type: 'password' },
                    { name: 'endpoint', label: 'Endpoint *', type: 'text', placeholder: 'https://your-resource.openai.azure.com/' },
                    { name: 'deploymentId', label: 'Deployment ID *', type: 'text' },
                    { name: 'apiVersion', label: 'API Version', type: 'text', value: '2024-02-15-preview' }
                ]
            },
            openai: {
                label: 'OpenAI',
                fields: [
                    { name: 'apiKey', label: 'API Key *', type: 'password' },
                    { name: 'model', label: 'Model *', type: 'text', placeholder: 'gpt-4o', value: 'gpt-4o' }
                ]
            },
            claude: {
                label: 'Anthropic Claude',
                fields: [
                    { name: 'apiKey', label: 'API Key *', type: 'password' },
                    { name: 'model', label: 'Model *', type: 'text', placeholder: 'claude-3-sonnet-20240229', value: 'claude-3-sonnet-20240229' }
                ]
            },
            google: {
                label: 'Google Gemini',
                fields: [
                    { name: 'apiKey', label: 'API Key *', type: 'password' },
                    { name: 'model', label: 'Model *', type: 'text', placeholder: 'gemini-pro', value: 'gemini-pro' }
                ]
            },
            databricks: {
                label: 'Databricks',
                fields: [
                    { name: 'endpoint', label: 'Endpoint *', type: 'text', placeholder: 'https://your-workspace.cloud.databricks.com/serving-endpoints/...' },
                    { name: 'apiKey', label: 'API Token *', type: 'password' },
                    { name: 'model', label: 'Model Name', type: 'text', placeholder: 'databricks-meta-llama-3-70b-instruct' }
                ]
            },
            ollama: {
                label: 'Ollama (Local)',
                fields: [
                    { name: 'endpoint', label: 'Endpoint *', type: 'text', placeholder: 'http://localhost:11434', value: 'http://localhost:11434' },
                    { name: 'model', label: 'Model *', type: 'text', placeholder: 'llama2' }
                ]
            },
            generic: {
                label: 'Generic/Custom',
                fields: [
                    { name: 'endpoint', label: 'API Endpoint *', type: 'text', placeholder: 'https://your-api.com/v1/chat/completions' },
                    { name: 'apiKey', label: 'API Key', type: 'password' },
                    { name: 'model', label: 'Model Name *', type: 'text' }
                ]
            }
        };
        
        function updateProviderFields() {
            const provider = document.getElementById('provider').value;
            const configDiv = document.getElementById('providerConfig');
            
            if (!provider) {
                configDiv.innerHTML = '';
                return;
            }
            
            const config = providerConfigs[provider];
            let html = `<div class="provider-section"><h3>${config.label} Configuration</h3>`;
            
            const fieldRows = [];
            for (let i = 0; i < config.fields.length; i += 2) {
                const field1 = config.fields[i];
                const field2 = config.fields[i + 1];
                
                let row = '<div class="field-row">';
                row += createFieldHTML(field1);
                if (field2) row += createFieldHTML(field2);
                row += '</div>';
                fieldRows.push(row);
            }
            
            html += fieldRows.join('') + '</div>';
            configDiv.innerHTML = html;
        }
        
        function createFieldHTML(field) {
            const value = field.value || '';
            const placeholder = field.placeholder || '';
            return `<div class="input-item">
                <label for="${field.name}">${field.label}</label>
                <input type="${field.type}" id="${field.name}" placeholder="${placeholder}" value="${value}">
            </div>`;
        }
        
        async function runComparison() {
            const provider = document.getElementById('provider').value;
            const testPrompt = document.getElementById('testPrompt').value;
            const iterations = parseInt(document.getElementById('iterations').value);
            
            if (!provider) {
                showError('Please select an LLM provider');
                return;
            }
            
            if (!testPrompt) {
                showError('Please enter a test prompt');
                return;
            }
            
            document.getElementById('loading').style.display = 'block';
            document.getElementById('resultsSection').classList.remove('active');
            clearMessages();
            
            try {
                const config = getProviderConfig(provider);
                const results = await callLLMAPI(provider, config, testPrompt, iterations);
                displayResults(results);
                showSuccess('Comparison completed successfully!');
            } catch (error) {
                showError(`Error: ${error.message}`);
            } finally {
                document.getElementById('loading').style.display = 'none';
            }
        }
        
        function getProviderConfig(provider) {
            const config = {};
            const fields = providerConfigs[provider].fields;
            fields.forEach(field => {
                const value = document.getElementById(field.name).value;
                if (!value && field.label.includes('*')) {
                    throw new Error(`Missing required field: ${field.label}`);
                }
                config[field.name] = value;
            });
            return config;
        }
        
        async function callLLMAPI(provider, config, prompt, iterations) {
            let totalTokens = { json: 0, toon: 0, vsc: 0 };
            let responses = { json: [], toon: [], vsc: [] };
            
            for (let i = 0; i < iterations; i++) {
                const prompts = {
                    json: formatPromptForProvider(provider, 'json', prompt),
                    toon: formatPromptForProvider(provider, 'toon', prompt),
                    vsc: formatPromptForProvider(provider, 'vsc', prompt)
                };
                
                for (const [format, formattedPrompt] of Object.entries(prompts)) {
                    try {
                        const result = await makeAPICall(provider, config, formattedPrompt);
                        totalTokens[format] += result.tokens;
                        responses[format].push({
                            tokens: result.tokens,
                            content: result.content
                        });
                    } catch (err) {
                        console.error(`Error calling ${provider} API with ${format}:`, err);
                        throw err;
                    }
                }
            }
            
            return {
                iterations,
                provider,
                basePrompt: prompt,
                totalTokens,
                responses,
                averageTokens: {
                    json: Math.round(totalTokens.json / iterations),
                    toon: Math.round(totalTokens.toon / iterations),
                    vsc: Math.round(totalTokens.vsc / iterations)
                }
            };
        }
        
        function formatPromptForProvider(provider, format, basePrompt) {
            // Strategy: Wrap the prompt with format-optimized metadata WITHOUT changing the actual prompt content
            // This preserves LLM accuracy while reducing token overhead
            
            const wrappers = {
                json: {
                    prefix: JSON.stringify({
                        "metadata": {
                            "format": "json",
                            "encoding": "utf-8"
                        }
                    }, null, 2) + "\n\nPrompt:\n",
                    suffix: ""
                },
                toon: {
                    prefix: `{m:{f:"json",e:"utf8"}}\nPrompt:\n`,
                    suffix: ""
                },
                vsc: {
                    prefix: `{m:{f:j,e:u8}}\n`,
                    suffix: ""
                }
            };
            
            const wrapper = wrappers[format] || wrappers.json;
            return wrapper.prefix + basePrompt + wrapper.suffix;
        }
        
        async function makeAPICall(provider, config, prompt) {
            let url, options, responseParser;
            
            switch(provider) {
                case 'azure':
                    url = `${config.endpoint}openai/deployments/${config.deploymentId}/chat/completions?api-version=${config.apiVersion}`;
                    options = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'api-key': config.apiKey
                        },
                        body: JSON.stringify({
                            messages: [{ role: 'user', content: prompt }],
                            max_tokens: 500,
                            temperature: 0.7
                        })
                    };
                    responseParser = (data) => ({
                        tokens: data.usage.total_tokens,
                        content: data.choices[0].message.content
                    });
                    break;
                    
                case 'openai':
                    url = 'https://api.openai.com/v1/chat/completions';
                    options = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${config.apiKey}`
                        },
                        body: JSON.stringify({
                            model: config.model,
                            messages: [{ role: 'user', content: prompt }],
                            max_tokens: 500,
                            temperature: 0.7
                        })
                    };
                    responseParser = (data) => ({
                        tokens: data.usage.total_tokens,
                        content: data.choices[0].message.content
                    });
                    break;
                    
                case 'claude':
                    url = 'https://api.anthropic.com/v1/messages';
                    options = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'x-api-key': config.apiKey,
                            'anthropic-version': '2023-06-01'
                        },
                        body: JSON.stringify({
                            model: config.model,
                            max_tokens: 500,
                            messages: [{ role: 'user', content: prompt }]
                        })
                    };
                    responseParser = (data) => ({
                        tokens: data.usage.input_tokens + data.usage.output_tokens,
                        content: data.content[0].text
                    });
                    break;
                    
                case 'google':
                    url = `https://generativelanguage.googleapis.com/v1beta/models/${config.model}:generateContent?key=${config.apiKey}`;
                    options = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            generationConfig: { maxOutputTokens: 500, temperature: 0.7 }
                        })
                    };
                    responseParser = (data) => {
                        if (!data.candidates || !data.candidates[0]) {
                            throw new Error('Invalid response from Google API: ' + JSON.stringify(data));
                        }
                        const candidate = data.candidates[0];
                        let content = 'No text response';
                        if (candidate.content && candidate.content.parts && candidate.content.parts.length > 0) {
                            const textPart = candidate.content.parts.find(p => p.text);
                            content = textPart ? textPart.text : 'No text response';
                        }
                        return {
                            tokens: data.usageMetadata?.totalTokenCount || 100,
                            content: content
                        };
                    };
                    break;
                    
                case 'databricks':
                    url = config.endpoint;
                    options = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${config.apiKey}`
                        },
                        body: JSON.stringify({
                            messages: [{ role: 'user', content: prompt }],
                            max_tokens: 500,
                            temperature: 0.7
                        })
                    };
                    responseParser = (data) => ({
                        tokens: data.usage?.total_tokens || 100,
                        content: data.choices[0].message.content
                    });
                    break;
                    
                case 'ollama':
                    url = `${config.endpoint}/api/chat`;
                    options = {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            model: config.model,
                            messages: [{ role: 'user', content: prompt }],
                            stream: false
                        })
                    };
                    responseParser = (data) => ({
                        tokens: Math.ceil((data.message.content.length) / 4),
                        content: data.message.content
                    });
                    break;
                    
                default:
                    url = config.endpoint;
                    options = {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            ...(config.apiKey && { 'Authorization': `Bearer ${config.apiKey}` })
                        },
                        body: JSON.stringify({
                            model: config.model,
                            messages: [{ role: 'user', content: prompt }],
                            max_tokens: 500
                        })
                    };
                    responseParser = (data) => ({
                        tokens: data.usage?.total_tokens || 100,
                        content: data.choices?.[0]?.message?.content || data.content
                    });
            }
            
            const response = await fetch(url, options);
            if (!response.ok) {
                const error = await response.json();
                throw new Error(error.error?.message || error.message || `API error: ${response.status}`);
            }
            
            const data = await response.json();
            return responseParser(data);
        }
        

        
        function displayResults(results) {
            const avgTokens = results.averageTokens;
            const jsonSavings = Math.round(((avgTokens.json - avgTokens.toon) / avgTokens.json) * 100);
            const vscSavings = Math.round(((avgTokens.json - avgTokens.vsc) / avgTokens.json) * 100);
            
            const costPerMillionTokens = 0.03;
            const jsonCost = (results.totalTokens.json / 1000000) * costPerMillionTokens;
            const toonCost = (results.totalTokens.toon / 1000000) * costPerMillionTokens;
            const vscCost = (results.totalTokens.vsc / 1000000) * costPerMillionTokens;
            
            const costSavingsToon = jsonCost - toonCost;
            const costSavingsVSC = jsonCost - vscCost;
            
            displaySummaryCards(avgTokens, jsonSavings, vscSavings, costSavingsToon, costSavingsVSC);
            displayChart(avgTokens);
            displayTable(results, avgTokens, jsonSavings, vscSavings, costSavingsToon, costSavingsVSC, jsonCost, toonCost, vscCost);
            displayWrapperComparison(results.basePrompt);
            displayAccuracyCheck(results.responses);
            
            document.getElementById('resultsSection').classList.add('active');
        }
        
        function displayWrapperComparison(basePrompt) {
            const wrappers = {
                json: `{"metadata": {"format": "json", "encoding": "utf-8"}}\n\nPrompt:\n${basePrompt}`,
                toon: `{m:{f:"json",e:"utf8"}}\nPrompt:\n${basePrompt}`,
                vsc: `{m:{f:j,e:u8}}\n${basePrompt}`
            };
            
            const jsonWrapper = wrappers.json;
            const toonWrapper = wrappers.toon;
            const vscWrapper = wrappers.vsc;
            
            const tableHTML = `
                <thead>
                    <tr>
                        <th>Format</th>
                        <th>Wrapper Example</th>
                        <th>Wrapper Size (chars)</th>
                        <th>Compression vs JSON</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>JSON</strong></td>
                        <td><code style="font-size: 0.85em; background: #f5f5f5; padding: 5px; border-radius: 3px;">${jsonWrapper.substring(0, 60)}...</code></td>
                        <td>${jsonWrapper.length}</td>
                        <td>Baseline</td>
                    </tr>
                    <tr>
                        <td><strong>TOON</strong></td>
                        <td><code style="font-size: 0.85em; background: #f5f5f5; padding: 5px; border-radius: 3px;">${toonWrapper.substring(0, 60)}...</code></td>
                        <td>${toonWrapper.length}</td>
                        <td>${Math.round(((jsonWrapper.length - toonWrapper.length) / jsonWrapper.length) * 100)}% smaller</td>
                    </tr>
                    <tr>
                        <td><strong>VSC</strong></td>
                        <td><code style="font-size: 0.85em; background: #f5f5f5; padding: 5px; border-radius: 3px;">${vscWrapper.substring(0, 60)}...</code></td>
                        <td>${vscWrapper.length}</td>
                        <td>${Math.round(((jsonWrapper.length - vscWrapper.length) / jsonWrapper.length) * 100)}% smaller</td>
                    </tr>
                </tbody>
            `;
            document.getElementById('wrapperComparisonTable').innerHTML = tableHTML;
        }
        
        function displayAccuracyCheck(responses) {
            // Calculate similarity between responses using simple heuristics
            const getSimilarityScore = (text1, text2) => {
                if (!text1 || !text2) return 0;
                const words1 = text1.toLowerCase().split(/\s+/).slice(0, 20);
                const words2 = text2.toLowerCase().split(/\s+/).slice(0, 20);
                const commonWords = words1.filter(w => words2.includes(w)).length;
                return Math.round((commonWords / Math.max(words1.length, words2.length)) * 100);
            };
            
            const jsonResponse = responses.json[0]?.content || '';
            const toonResponse = responses.toon[0]?.content || '';
            const vscResponse = responses.vsc[0]?.content || '';
            
            const toonVsJson = getSimilarityScore(jsonResponse, toonResponse);
            const vscVsJson = getSimilarityScore(jsonResponse, vscResponse);
            
            const tableHTML = `
                <thead>
                    <tr>
                        <th>Comparison</th>
                        <th>Similarity Score</th>
                        <th>Status</th>
                        <th>First 100 chars</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>JSON (Baseline)</strong></td>
                        <td>-</td>
                        <td><span style="color: #10b981;">‚úì Reference</span></td>
                        <td><code style="font-size: 0.85em;">${jsonResponse.substring(0, 100)}...</code></td>
                    </tr>
                    <tr>
                        <td><strong>TOON vs JSON</strong></td>
                        <td>${toonVsJson}%</td>
                        <td>${toonVsJson >= 80 ? '<span style="color: #10b981;">‚úì Accurate</span>' : toonVsJson >= 60 ? '<span style="color: #f59e0b;">‚ö† Acceptable</span>' : '<span style="color: #ef4444;">‚úó Different</span>'}</td>
                        <td><code style="font-size: 0.85em;">${toonResponse.substring(0, 100)}...</code></td>
                    </tr>
                    <tr>
                        <td><strong>VSC vs JSON</strong></td>
                        <td>${vscVsJson}%</td>
                        <td>${vscVsJson >= 80 ? '<span style="color: #10b981;">‚úì Accurate</span>' : vscVsJson >= 60 ? '<span style="color: #f59e0b;">‚ö† Acceptable</span>' : '<span style="color: #ef4444;">‚úó Different</span>'}</td>
                        <td><code style="font-size: 0.85em;">${vscResponse.substring(0, 100)}...</code></td>
                    </tr>
                    <tr class="highlight-row">
                        <td><strong>Key Insight</strong></td>
                        <td colspan="3">High similarity scores (>80%) confirm the wrapper strategy preserves accuracy while reducing tokens. Prompt content remains identical across formats.</td>
                    </tr>
                </tbody>
            `;
            document.getElementById('accuracyTable').innerHTML = tableHTML;
        }
        
        function displaySummaryCards(avgTokens, jsonSavings, vscSavings, costSavingsToon, costSavingsVSC) {
            const cardsHTML = `
                <div class="card">
                    <h3>Avg Tokens (JSON)</h3>
                    <div class="card-value">${avgTokens.json}</div>
                </div>
                <div class="card">
                    <h3>Avg Tokens (TOON)</h3>
                    <div class="card-value">${avgTokens.toon}</div>
                </div>
                <div class="card">
                    <h3>Avg Tokens (VSC)</h3>
                    <div class="card-value">${avgTokens.vsc}</div>
                </div>
                <div class="card">
                    <h3>Savings: JSON‚ÜíTOON</h3>
                    <div class="card-value" style="color: #10b981;">${jsonSavings}%</div>
                </div>
                <div class="card">
                    <h3>Savings: JSON‚ÜíVSC</h3>
                    <div class="card-value" style="color: #10b981;">${vscSavings}%</div>
                </div>
            `;
            document.getElementById('summaryCards').innerHTML = cardsHTML;
        }
        
        function displayChart(avgTokens) {
            const ctx = document.getElementById('tokenChart').getContext('2d');
            
            if (tokenChart) {
                tokenChart.destroy();
            }
            
            tokenChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['JSON', 'TOON', 'VSC'],
                    datasets: [{
                        label: 'Average Tokens per Request',
                        data: [avgTokens.json, avgTokens.toon, avgTokens.vsc],
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(118, 75, 162, 0.8)',
                            'rgba(16, 185, 129, 0.8)'
                        ],
                        borderColor: [
                            'rgba(102, 126, 234, 1)',
                            'rgba(118, 75, 162, 1)',
                            'rgba(16, 185, 129, 1)'
                        ],
                        borderWidth: 2,
                        borderRadius: 8
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: { font: { size: 12 }, color: '#666' },
                            grid: { color: 'rgba(0,0,0,0.05)' }
                        },
                        x: {
                            ticks: {
                                font: { size: 12, weight: 'bold' },
                                color: '#333'
                            },
                            grid: { display: false }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            labels: { font: { size: 12 }, color: '#333' }
                        }
                    }
                }
            });
        }
        
        function displayTable(results, avgTokens, jsonSavings, vscSavings, costSavingsToon, costSavingsVSC, jsonCost, toonCost, vscCost) {
            const tableHTML = `
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>JSON</th>
                        <th>TOON</th>
                        <th>VSC</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td><strong>Provider</strong></td>
                        <td colspan="3">${results.provider.toUpperCase()}</td>
                    </tr>
                    <tr>
                        <td><strong>Average Tokens/Request</strong></td>
                        <td>${avgTokens.json}</td>
                        <td>${avgTokens.toon}</td>
                        <td>${avgTokens.vsc}</td>
                    </tr>
                    <tr>
                        <td><strong>Total Tokens (${results.iterations} iterations)</strong></td>
                        <td>${results.totalTokens.json}</td>
                        <td>${results.totalTokens.toon}</td>
                        <td>${results.totalTokens.vsc}</td>
                    </tr>
                    <tr>
                        <td><strong>Estimated Cost*</strong></td>
                        <td>${jsonCost.toFixed(6)}</td>
                        <td>${toonCost.toFixed(6)}</td>
                        <td>${vscCost.toFixed(6)}</td>
                    </tr>
                    <tr class="highlight-row">
                        <td><strong>üí∞ Cost Savings vs JSON</strong></td>
                        <td>Baseline</td>
                        <td><span class="savings">${costSavingsToon.toFixed(6)} (${jsonSavings}%)</span></td>
                        <td><span class="savings">${costSavingsVSC.toFixed(6)} (${vscSavings}%)</span></td>
                    </tr>
                </tbody>
            `;
            document.getElementById('resultsTable').innerHTML = tableHTML;
        }
        
        function clearResults() {
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('summaryCards').innerHTML = '';
            document.getElementById('resultsTable').innerHTML = '';
            document.getElementById('wrapperComparisonTable').innerHTML = '';
            document.getElementById('accuracyTable').innerHTML = '';
            clearMessages();
            if (tokenChart) {
                tokenChart.destroy();
                tokenChart = null;
            }
        }
        
        function showError(message) {
            const errorEl = document.getElementById('errorMessage');
            errorEl.textContent = message;
            errorEl.style.display = 'block';
        }
        
        function showSuccess(message) {
            const successEl = document.getElementById('successMessage');
            successEl.textContent = message;
            successEl.style.display = 'block';
        }
        
        function clearMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('successMessage').style.display = 'none';
        }
    </script>
</body>
</html>